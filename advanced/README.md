# Redis ì¤‘ê¸‰ ê¸°ëŠ¥ ë° ì˜ì†ì„±

Redisë¥¼ ìš´ì˜ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ê°œë…ë“¤ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“Œ ëª©ì°¨

1. [ë°ì´í„° ì˜ì†ì„± (Persistence)](#1-ë°ì´í„°-ì˜ì†ì„±-persistence)
2. [Pub/Sub (ë°œí–‰/êµ¬ë…)](#2-pubsub-ë°œí–‰êµ¬ë…)
3. [Transactions (íŠ¸ëœì­ì…˜)](#3-transactions-íŠ¸ëœì­ì…˜)
4. [Pipelining (íŒŒì´í”„ë¼ì´ë‹)](#4-pipelining-íŒŒì´í”„ë¼ì´ë‹)
5. [Atomic ì—°ì‚°](#5-atomic-ì—°ì‚°)

---

## 1. ë°ì´í„° ì˜ì†ì„± (Persistence)

RedisëŠ” In-memory DBì´ì§€ë§Œ, ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ì˜ì†ì„± ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì„œë²„ê°€ ì¬ì‹œì‘ë˜ë”ë¼ë„ ë””ìŠ¤í¬ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì½ì–´ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ”¸ RDB (Snapshotting) ë°©ì‹

íŠ¹ì • ì‹œì ì˜ ë©”ëª¨ë¦¬ ë°ì´í„° ì „ì²´ë¥¼ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

#### íŠ¹ì§•
- **ìŠ¤ëƒ…ìƒ· ë°©ì‹**: íŠ¹ì • ì‹œì ì˜ ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ ë°”ì´ë„ˆë¦¬ íŒŒì¼(`dump.rdb`)ë¡œ ì €ì¥
- **ë²„ì „ ê´€ë¦¬ ê°€ëŠ¥**: íŠ¹ì • ì‹œì ì˜ ë°ì´í„°ë¡œ ë³µêµ¬ ê°€ëŠ¥
- **íŒŒì¼ í¬ê¸°**: AOFë³´ë‹¤ ì‘ì•„ì„œ ë¡œë”© ì†ë„ê°€ ë¹ ë¦„
- **ê¸°ë³¸ ì„¤ì •**: RedisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ RDB ë°©ì‹ì´ í™œì„±í™”ë˜ì–´ ìˆìŒ

#### ì¥ì 
- âœ… ë¹ ë¥¸ ë³µêµ¬ ì†ë„ (ìŠ¤ëƒ…ìƒ·ì„ ê·¸ëŒ€ë¡œ ì½ê¸°ë§Œ í•˜ë©´ ë¨)
- âœ… íŒŒì¼ í¬ê¸°ê°€ ì‘ìŒ
- âœ… ë°±ì—… ë° ì¬í•´ ë³µêµ¬ì— ìœ ë¦¬

#### ë‹¨ì 
- âŒ ìŠ¤ëƒ…ìƒ· ìƒì„±ì— ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼ (50GB ê¸°ì¤€ ì•½ 7~8ë¶„)
- âŒ ìŠ¤ëƒ…ìƒ· ì‹œì  ì‚¬ì´ì˜ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
- âŒ `fork()` ì‹œ Copy-on-Writeë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ë¶€ì¡± ìœ„í—˜

#### ì„¤ì • ë°©ë²•

```conf
# redis.conf
save 900 1      # 900ì´ˆ(15ë¶„) ë™ì•ˆ 1ê°œ ì´ìƒì˜ í‚¤ê°€ ë³€ê²½ë˜ë©´ ì €ì¥
save 300 10     # 300ì´ˆ(5ë¶„) ë™ì•ˆ 10ê°œ ì´ìƒì˜ í‚¤ê°€ ë³€ê²½ë˜ë©´ ì €ì¥
save 60 10000   # 60ì´ˆ(1ë¶„) ë™ì•ˆ 10000ê°œ ì´ìƒì˜ í‚¤ê°€ ë³€ê²½ë˜ë©´ ì €ì¥
```

#### ëª…ë ¹ì–´
- `SAVE`: ë™ê¸° ë°©ì‹ìœ¼ë¡œ ìŠ¤ëƒ…ìƒ· ìƒì„± (ëª¨ë“  ìš”ì²­ ëŒ€ê¸°, ê¶Œì¥ ì•ˆ í•¨)
- `BGSAVE`: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ ìŠ¤ëƒ…ìƒ· ìƒì„± (ê¶Œì¥)

#### ì£¼ì˜ì‚¬í•­

> âš ï¸ **ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ì£¼ì˜**  
> `BGSAVE` ì‹¤í–‰ ì‹œ Copy-on-Write(COW)ë¡œ ì¸í•´ ìµœëŒ€ 2ë°°ì˜ ë©”ëª¨ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> ì˜ˆ: Redisê°€ 6GBë¥¼ ì‚¬ìš©í•˜ê³  ì„œë²„ ë©”ëª¨ë¦¬ê°€ 10GBì¸ ê²½ìš°, COWë¡œ 12GBê°€ í•„ìš”í•˜ë©´ swapì´ ë°œìƒí•˜ì—¬ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ”¸ AOF (Append Only File) ë°©ì‹

ëª¨ë“  ì“°ê¸°/ì—…ë°ì´íŠ¸ ì—°ì‚°ì„ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

#### íŠ¹ì§•
- **ë¡œê·¸ ë°©ì‹**: ëª¨ë“  write/update ëª…ë ¹ì„ `appendonly.aof` íŒŒì¼ì— ê¸°ë¡
- **ë³µêµ¬ ë°©ì‹**: ì„œë²„ ì¬ì‹œì‘ ì‹œ ë¡œê·¸ì— ê¸°ë¡ëœ ëª…ë ¹ì„ ìˆœì°¨ì ìœ¼ë¡œ ì¬ì‹¤í–‰
- **ì‹¤ì‹œê°„ ì €ì¥**: ëª…ë ¹ ì‹¤í–‰ ì‹œë§ˆë‹¤ ê¸°ë¡ë˜ë¯€ë¡œ ë°ì´í„° ì†ì‹¤ ìµœì†Œí™”
- **í…ìŠ¤íŠ¸ íŒŒì¼**: í¸ì§‘ ê°€ëŠ¥ (RDBëŠ” ë°”ì´ë„ˆë¦¬ íŒŒì¼)

#### ë™ì‘ ìˆœì„œ
1. í´ë¼ì´ì–¸íŠ¸ê°€ ì—…ë°ì´íŠ¸ ëª…ë ¹ ìš”ì²­
2. Redisê°€ ëª…ë ¹ì„ AOF íŒŒì¼ì— ì €ì¥
3. íŒŒì¼ ì“°ê¸° ì™„ë£Œ í›„ ì‹¤ì œ ë©”ëª¨ë¦¬ì— ë°˜ì˜

#### ì¥ì 
- âœ… ë°ì´í„° ì†ì‹¤ ìµœì†Œí™” (ê±°ì˜ ì‹¤ì‹œê°„ ì €ì¥)
- âœ… Non-blocking ë°©ì‹ìœ¼ë¡œ ë™ì‘
- âœ… í…ìŠ¤íŠ¸ íŒŒì¼ì´ë¼ í¸ì§‘ ê°€ëŠ¥

#### ë‹¨ì 
- âŒ íŒŒì¼ í¬ê¸°ê°€ í¼ (ëª¨ë“  ì—°ì‚° ê¸°ë¡)
- âŒ ë³µêµ¬ ì†ë„ê°€ ëŠë¦¼ (ëª¨ë“  ëª…ë ¹ì„ ì¬ì‹¤í–‰)
- âŒ ì¤‘ë³µ ëª…ë ¹ìœ¼ë¡œ ì¸í•œ ë¹„íš¨ìœ¨ (ì˜ˆ: ê°™ì€ í‚¤ì— ì—¬ëŸ¬ ë²ˆ SET)

#### ì„¤ì • ë°©ë²•

```conf
# redis.conf
appendonly yes                    # AOF í™œì„±í™”
appendfilename "appendonly.aof"   # AOF íŒŒì¼ëª…

# fsync ì •ì±…
appendfsync always   # ë§¤ ëª…ë ¹ë§ˆë‹¤ fsync (ê°€ì¥ ì•ˆì „, ëŠë¦¼)
appendfsync everysec # 1ì´ˆë§ˆë‹¤ fsync (ê¶Œì¥)
appendfsync no       # OSì— ìœ„ì„ (ë¹ ë¦„, ë°ì´í„° ì†ì‹¤ ìœ„í—˜)
```

#### AOF Rewrite
AOF íŒŒì¼ì´ ê³„ì† ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ **Rewrite** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

```bash
# ìˆ˜ë™ ì‹¤í–‰
> BGREWRITEAOF
```

**Rewrite íš¨ê³¼**: ì¤‘ë³µëœ ëª…ë ¹ì„ ì œê±°í•˜ê³  ìµœì¢… ìƒíƒœë§Œ ê¸°ë¡í•˜ì—¬ íŒŒì¼ í¬ê¸° ê°ì†Œ

ì˜ˆì‹œ:
```bash
# ì›ë³¸ AOF (100ê°œì˜ INCR ëª…ë ¹)
INCR counter
INCR counter
...
INCR counter

# Rewrite í›„
SET counter 100
```

---

### ğŸ”¸ RDB vs AOF ì„ íƒ ê¸°ì¤€

| ê¸°ì¤€ | RDB | AOF | RDB + AOF í˜¼ìš© |
|------|-----|-----|----------------|
| **ë°ì´í„° ì†ì‹¤ í—ˆìš©** | â­• ì¼ë¶€ í—ˆìš© ê°€ëŠ¥ | âŒ ê±°ì˜ í—ˆìš© ì•ˆ ë¨ | â­• ìµœì†Œí™” |
| **ë³µêµ¬ ì†ë„** | âš¡ ë¹ ë¦„ | ğŸ¢ ëŠë¦¼ | âš¡ ë¹ ë¦„ |
| **íŒŒì¼ í¬ê¸°** | ğŸ“¦ ì‘ìŒ | ğŸ“¦ í¼ | ğŸ“¦ ì¤‘ê°„ |
| **ì‚¬ìš© ì‚¬ë¡€** | ìºì‹œ, í†µê³„ ë°ì´í„° | ê¸ˆìœµ, ì£¼ë¬¸ ë°ì´í„° | ì¼ë°˜ì ì¸ ìš´ì˜ í™˜ê²½ |

#### ê¶Œì¥ ì „ëµ

**1. ìºì‹œ ì „ìš©**
```conf
# ë°±ì—… ë¶ˆí•„ìš”
save ""
appendonly no
```

**2. ì¼ë¶€ ë°ì´í„° ì†ì‹¤ í—ˆìš©**
```conf
save 900 1
appendonly no
```

**3. ë°ì´í„° ì†ì‹¤ ê±°ì˜ ë¶ˆí—ˆ (ê¶Œì¥)**
```conf
# RDB + AOF í˜¼ìš©
save 900 1
appendonly yes
appendfsync everysec
```

> ğŸ’¡ **Best Practice**  
> ì£¼ê¸°ì ìœ¼ë¡œ RDBë¡œ ìŠ¤ëƒ…ìƒ·ì„ ë°±ì—…í•˜ê³ , ë‹¤ìŒ ìŠ¤ëƒ…ìƒ·ê¹Œì§€ì˜ ë³€ê²½ì‚¬í•­ì€ AOFë¡œ ì €ì¥í•˜ëŠ” **RDB + AOF í˜¼ìš©** ë°©ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.  
> ì´ë ‡ê²Œ í•˜ë©´ ë¹ ë¥¸ ë³µêµ¬ ì†ë„ì™€ ìµœì†Œí•œì˜ ë°ì´í„° ì†ì‹¤ì„ ë™ì‹œì— ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 2. Pub/Sub (ë°œí–‰/êµ¬ë…)

Redisì˜ ë©”ì‹œì§• íŒ¨í„´ìœ¼ë¡œ, ë°œí–‰ì(Publisher)ì™€ êµ¬ë…ì(Subscriber) ê°„ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ë‹¬ì„ ì§€ì›í•©ë‹ˆë‹¤.

### íŠ¹ì§•
- **ì±„ë„ ê¸°ë°˜**: íŠ¹ì • ì±„ë„ì— ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³  êµ¬ë…
- **1:N í†µì‹ **: í•˜ë‚˜ì˜ ë©”ì‹œì§€ê°€ ì—¬ëŸ¬ êµ¬ë…ìì—ê²Œ ì „ë‹¬
- **ì‹¤ì‹œê°„**: ë©”ì‹œì§€ê°€ ì¦‰ì‹œ ì „ë‹¬ë¨
- **íœ˜ë°œì„±**: ë©”ì‹œì§€ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ (ì—°ê²°ëœ êµ¬ë…ìì—ê²Œë§Œ ì „ë‹¬)

### ì£¼ìš” ëª…ë ¹ì–´

```bash
# ì±„ë„ êµ¬ë…
SUBSCRIBE channel1 channel2 ...

# íŒ¨í„´ ê¸°ë°˜ êµ¬ë… (ì™€ì¼ë“œì¹´ë“œ)
PSUBSCRIBE news.* sport.*

# ë©”ì‹œì§€ ë°œí–‰
PUBLISH channel "message"

# êµ¬ë… í•´ì œ
UNSUBSCRIBE channel1
PUNSUBSCRIBE pattern1
```

### ì‚¬ìš© ì‚¬ë¡€
- ğŸ“¢ ì‹¤ì‹œê°„ ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜
- ğŸ”” í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ
- ğŸ“Š ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë°
- ğŸ¯ ì´ë²¤íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŒ…

### ì£¼ì˜ì‚¬í•­

> âš ï¸ **ë©”ì‹œì§€ ì†ì‹¤ ê°€ëŠ¥**  
> - Pub/Subì€ ë©”ì‹œì§€ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
> - êµ¬ë…ìê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
> - ì‹ ë¢°ì„± ìˆëŠ” ë©”ì‹œì§•ì´ í•„ìš”í•˜ë©´ Redis Streams ì‚¬ìš©ì„ ê³ ë ¤í•˜ì„¸ìš”

---

## 3. Transactions (íŠ¸ëœì­ì…˜)

ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ ì›ìì (Atomic)ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

### ê¸°ë³¸ ê°œë…

Redis íŠ¸ëœì­ì…˜ì€ **MULTI**ë¡œ ì‹œì‘í•˜ê³  **EXEC**ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```bash
> MULTI
OK
> INCR counter
QUEUED
> INCR counter
QUEUED
> EXEC
1) (integer) 1
2) (integer) 2
```

### ì£¼ìš” ëª…ë ¹ì–´

- `MULTI`: íŠ¸ëœì­ì…˜ ì‹œì‘
- `EXEC`: íì— ìŒ“ì¸ ëª…ë ¹ì–´ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
- `DISCARD`: íŠ¸ëœì­ì…˜ ì·¨ì†Œ (í ë¹„ìš°ê¸°)
- `WATCH`: ë‚™ê´€ì  ì ê¸ˆ (Optimistic Locking)

### íŠ¹ì§•

#### âœ… ë³´ì¥ë˜ëŠ” ê²ƒ
1. **ì›ìì„±**: ëª¨ë“  ëª…ë ¹ì´ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë¨
2. **ê²©ë¦¬ì„±**: íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì´ ë¼ì–´ë“¤ì§€ ì•ŠìŒ
3. **ëª…ë ¹ íì‰**: EXEC í˜¸ì¶œ ì „ê¹Œì§€ ëª¨ë“  ëª…ë ¹ì´ íì— ì €ì¥ë¨

#### âŒ RDBMS íŠ¸ëœì­ì…˜ê³¼ì˜ ì°¨ì´ì 

> **ë¡¤ë°±(Rollback) ë¯¸ì§€ì›**  
> RedisëŠ” íŠ¸ëœì­ì…˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.  
> 
> **ì´ìœ **:
> - Redis ëª…ë ¹ì€ êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ìœ¼ë©´ ì‹¤íŒ¨í•˜ì§€ ì•ŠìŒ
> - ë‹¨ìˆœí•˜ê³  ë¹ ë¥¸ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•¨
> - ì˜¤ë¥˜ëŠ” ëŒ€ë¶€ë¶„ í”„ë¡œê·¸ë˜ë° ì‹¤ìˆ˜ë¡œ ê°œë°œ ë‹¨ê³„ì—ì„œ ë°œê²¬ë¨

### WATCHë¥¼ ì´ìš©í•œ ë‚™ê´€ì  ì ê¸ˆ

**WATCH**ëŠ” CAS(Check-And-Set) ë™ì‘ì„ ì œê³µí•©ë‹ˆë‹¤.

```bash
# mykeyë¥¼ ê°ì‹œ
WATCH mykey

# ê°’ ì½ê¸°
val = GET mykey
val = val + 1

# íŠ¸ëœì­ì…˜ ì‹œì‘
MULTI
SET mykey $val
EXEC
```

**ë™ì‘ ë°©ì‹**:
- WATCHí•œ í‚¤ê°€ EXEC ì „ì— ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ ë³€ê²½ë˜ë©´
- EXECëŠ” `nil`ì„ ë°˜í™˜í•˜ê³  íŠ¸ëœì­ì…˜ì´ ì‹¤íŒ¨í•¨
- ì¬ì‹œë„ ë¡œì§ êµ¬í˜„ í•„ìš”

### ì‚¬ìš© ì˜ˆì‹œ: ì¬ê³  ê´€ë¦¬

```bash
# ì¬ê³  ì°¨ê° (ë‚™ê´€ì  ì ê¸ˆ ì‚¬ìš©)
WATCH product:123:stock
stock = GET product:123:stock

if stock > 0:
    MULTI
    DECR product:123:stock
    # ì£¼ë¬¸ ì •ë³´ ì €ì¥
    SADD user:orders order_id
    EXEC
else:
    UNWATCH
    # ì¬ê³  ë¶€ì¡±
```

---

## 4. Pipelining (íŒŒì´í”„ë¼ì´ë‹)

ì—¬ëŸ¬ ëª…ë ¹ì„ í•œ ë²ˆì˜ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ(RTT)ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

### ë¬¸ì œ ìƒí™©

ì¼ë°˜ì ì¸ ìš”ì²­-ì‘ë‹µ ëª¨ë¸:

```
Client: INCR X
Server: 1
[RTT 1]

Client: INCR X
Server: 2
[RTT 2]

Client: INCR X
Server: 3
[RTT 3]

ì´ ì‹œê°„: 3 RTT
```

### Pipelining ë™ì‘

```
Client: INCR X
Client: INCR X
Client: INCR X

Server: 1
Server: 2
Server: 3

ì´ ì‹œê°„: 1 RTT
```

### íŠ¹ì§•

- **ì„±ëŠ¥ í–¥ìƒ**: RTTë¥¼ ì¤„ì—¬ ëŒ€ëŸ‰ ì‘ì—… ì‹œ ê·¹ì ì¸ ì„±ëŠ¥ í–¥ìƒ
- **ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨**: ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ìµœëŒ€ í™œìš©
- **ë©”ëª¨ë¦¬ ë²„í¼ë§**: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ëª¨ë‘ ë²„í¼ì— ë°ì´í„° ìŒ“ìŒ

### Pipelining vs Transaction

| íŠ¹ì„± | Pipelining | Transaction |
|------|------------|-------------|
| **ëª©ì ** | ì„±ëŠ¥ í–¥ìƒ (RTT ê°ì†Œ) | ì›ìì„± ë³´ì¥ |
| **ì›ìì„±** | âŒ ë³´ì¥ ì•ˆ ë¨ | âœ… ë³´ì¥ë¨ |
| **ëª…ë ¹ ìˆœì„œ** | âœ… ë³´ì¥ë¨ | âœ… ë³´ì¥ë¨ |
| **ì¤‘ê°„ ë¼ì–´ë“¤ê¸°** | âš ï¸ ê°€ëŠ¥ | âŒ ë¶ˆê°€ëŠ¥ |
| **ë¡¤ë°±** | âŒ ë¯¸ì§€ì› | âŒ ë¯¸ì§€ì› |

### ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­

1. **ë©”ëª¨ë¦¬ ì‚¬ìš©**: ë„ˆë¬´ ë§ì€ ëª…ë ¹ì„ í•œ ë²ˆì— ë³´ë‚´ë©´ ë©”ëª¨ë¦¬ ë¶€ì¡± ë°œìƒ ê°€ëŠ¥
2. **ì ì ˆí•œ ë°°ì¹˜ í¬ê¸°**: ë³´í†µ 1000~10000ê°œ ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ ì²˜ë¦¬
3. **ì›ìì„± í•„ìš” ì‹œ**: Transaction ì‚¬ìš©

---

## 5. Atomic ì—°ì‚°

### Atomicì´ë€?

**ë” ì´ìƒ ìª¼ê°œì§ˆ ìˆ˜ ì—†ëŠ” ì—°ì‚°**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

#### ì¼ë°˜ì ì¸ `i++` ì—°ì‚°

```javascript
i++

// ì‹¤ì œë¡œëŠ” 3ë‹¨ê³„ë¡œ ë¶„ë¦¬ë¨
1. ë©”ëª¨ë¦¬ì—ì„œ i ê°’ ì½ê¸°
2. ì½ì€ ê°’ì— 1 ë”í•˜ê¸°
3. ê²°ê³¼ë¥¼ iì— ì €ì¥
```

#### ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œì˜ ë¬¸ì œ

```
ìŠ¤ë ˆë“œ A: i ê°’ ì½ê¸° (0)
ìŠ¤ë ˆë“œ B: i ê°’ ì½ê¸° (0)
ìŠ¤ë ˆë“œ A: 0 + 1 = 1
ìŠ¤ë ˆë“œ B: 0 + 1 = 1
ìŠ¤ë ˆë“œ A: iì— 1 ì €ì¥
ìŠ¤ë ˆë“œ B: iì— 1 ì €ì¥

ê²°ê³¼: 2ê°€ ë˜ì–´ì•¼ í•˜ì§€ë§Œ 1ì´ ë¨ âŒ
```

### Redisì—ì„œì˜ Atomic ì—°ì‚°

RedisëŠ” **ì‹±ê¸€ ìŠ¤ë ˆë“œ**ë¡œ ë™ì‘í•˜ë¯€ë¡œ ëª¨ë“  ëª…ë ¹ì–´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Atomicí•©ë‹ˆë‹¤.

#### ì˜¬ë°”ë¥¸ ë°©ë²•

```bash
# âŒ ì˜ëª»ëœ ë°©ë²• (ì›ìì„± ê¹¨ì§)
GET counter
# ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ +1
SET counter 2

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ì›ìì„± ë³´ì¥)
INCR counter
```

### Atomic ê¹¨ì§€ëŠ” ê²½ìš°

**ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ ì¡°í•©**í•  ë•Œ ì›ìì„±ì´ ê¹¨ì§‘ë‹ˆë‹¤.

```bash
# ì˜ˆ: í¬ì¸íŠ¸ ì°¨ê° í›„ ìƒí’ˆ ì§€ê¸‰
GET user:points     # 1000 í¬ì¸íŠ¸
# ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ í¬ì¸íŠ¸ ì‚¬ìš© âš ï¸
DECRBY user:points 100
SADD user:items item_id
```

### Atomic ë³´ì¥ ë°©ë²•

#### 1ï¸âƒ£ Lua Script ì‚¬ìš©

```lua
-- Lua ìŠ¤í¬ë¦½íŠ¸ëŠ” ì›ìì ìœ¼ë¡œ ì‹¤í–‰ë¨
EVAL "
    local points = redis.call('GET', KEYS[1])
    if tonumber(points) >= tonumber(ARGV[1]) then
        redis.call('DECRBY', KEYS[1], ARGV[1])
        redis.call('SADD', KEYS[2], ARGV[2])
        return 1
    else
        return 0
    end
" 2 user:points user:items 100 item_id
```

#### 2ï¸âƒ£ Transaction + WATCH ì‚¬ìš©

```bash
WATCH user:points
points = GET user:points

if points >= 100:
    MULTI
    DECRBY user:points 100
    SADD user:items item_id
    EXEC
else:
    UNWATCH
```

### Redisê°€ ì œê³µí•˜ëŠ” Atomic ëª…ë ¹ì–´

| ì‘ì—… | Atomic ëª…ë ¹ì–´ |
|------|---------------|
| ì¦ê°€/ê°ì†Œ | `INCR`, `DECR`, `INCRBY`, `DECRBY` |
| ë¦¬ìŠ¤íŠ¸ | `LPUSH`, `RPUSH`, `LPOP`, `RPOP`, `BRPOPLPUSH` |
| ì§‘í•© | `SADD`, `SREM`, `SPOP` |
| í•´ì‹œ | `HINCRBY`, `HSETNX` |
| ì¡°ê±´ë¶€ ì„¤ì • | `SETNX`, `SET ... NX/XX` |
| ë¹„íŠ¸ ì—°ì‚° | `SETBIT`, `GETBIT`, `BITCOUNT` |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Redis Persistence ê³µì‹ ë¬¸ì„œ](https://redis.io/docs/latest/operate/oss_and_stack/management/persistence/)
- [Redis Transactions ê³µì‹ ë¬¸ì„œ](https://redis.io/docs/latest/develop/using-commands/transactions/)
- [Redis Pipelining ê³µì‹ ë¬¸ì„œ](https://redis.io/docs/latest/develop/use/pipelining/)
- [Redis Pub/Sub ê³µì‹ ë¬¸ì„œ](https://redis.io/docs/latest/develop/interact/pubsub/)
- [ë°ì´í„° ì˜êµ¬ ì €ì¥í•˜ëŠ” ë°©ë²•](https://inpa.tistory.com/entry/REDIS-%F0%9F%93%9A-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%98%81%EA%B5%AC-%EC%A0%80%EC%9E%A5%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%98%81%EC%86%8D%EC%84%B1)
- [Atomic ì—°ì‚° ë³´ì¥í•˜ê¸°](https://f-lab.kr/blog/redis-command-for-atomic-operation)
- [Redis Commands ë ˆí¼ëŸ°ìŠ¤](https://redis.io/commands/)

---

## ğŸ¯ í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] RDBì™€ AOFì˜ ì°¨ì´ì ì„ ì´í•´í•˜ê³  ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ë‘ ë°©ì‹ì˜ ì¥ë‹¨ì ì„ ë¹„êµí•  ìˆ˜ ìˆë‹¤
- [ ] ìƒí™©ì— ë§ëŠ” ì˜ì†ì„± ì „ëµì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤
- [ ] BGSAVEì˜ COW ë¬¸ì œë¥¼ ì´í•´í•œë‹¤
- [ ] Pub/Subì˜ ë™ì‘ ë°©ì‹ê³¼ í•œê³„ë¥¼ ì•ˆë‹¤
- [ ] MULTI/EXECë¥¼ ì‚¬ìš©í•œ íŠ¸ëœì­ì…˜ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤
- [ ] WATCHë¥¼ ì´ìš©í•œ ë‚™ê´€ì  ì ê¸ˆì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
- [ ] Pipeliningê³¼ Transactionì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] Atomic ì—°ì‚°ì˜ ì¤‘ìš”ì„±ì„ ì´í•´í•œë‹¤
- [ ] Lua Scriptë¡œ ë³µì¡í•œ ì›ìì  ì—°ì‚°ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
